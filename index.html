<!DOCTYPE html>
<html>
<head>
    <title>Open-Meteo Bounding Box Precip</title>
</head>
<body>
    <h3>Max Precipitation in Bounding Box</h3>
    <label>Min Lat: <input id="minLat" value="42.8" step="0.01"></label><br>
    <label>Max Lat: <input id="maxLat" value="43.0" step="0.01"></label><br>
    <label>Min Lon: <input id="minLon" value="2.3" step="0.01"></label><br>
    <label>Max Lon: <input id="maxLon" value="2.5" step="0.01"></label><br>
    <button onclick="fetchPrecip()">Get Max Precip</button>
    <div id="results"></div>

    <script>
function fetchPrecip() {
    const minLat = parseFloat(document.getElementById('minLat').value);
    const maxLat = parseFloat(document.getElementById('maxLat').value);
    const minLon = parseFloat(document.getElementById('minLon').value);
    const maxLon = parseFloat(document.getElementById('maxLon').value);

    const corners = [
        {lat: minLat, lon: minLon},  // SW
        {lat: minLat, lon: maxLon},  // SE  
        {lat: maxLat, lon: minLon},  // NW
        {lat: maxLat, lon: maxLon}   // NE
    ];

    const latList = corners.map(c => c.lat).join(',');
    const lonList = corners.map(c => c.lon).join(',');

    const url = `https://api.open-meteo.com/v1/forecast?latitude=${latList}&longitude=${lonList}&hourly=precipitation&timezone=Europe/Paris&forecast_days=3`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            const times = data[0].hourly.time;
            const precipData = data[0].hourly.precipitation;
            
            // Extract precip for each corner per timeslot, find max
            const maxPrecip = times.map((time, i) => {
                const cornerPrecip = precipData.slice(i*4, i*4+4);
                return Math.max(...cornerPrecip);
            });

            displayResults(times, maxPrecip);
        })
        .catch(err => console.error('Error:', err));
}

function displayResults(times, maxPrecip) {
    let html = '<table border="1"><tr><th>Time (CET)</th><th>Max Precip (mm)</th></tr>';
    for (let i = 0; i < times.length; i++) {
        html += `<tr><td>${times[i]}</td><td>${maxPrecip[i].toFixed(2)}</td></tr>`;
    }
    html += '</table>';
    document.getElementById('results').innerHTML = html;
}
    </script>
</body>
</html>
