<!DOCTYPE html>
<html>
<head>
    <title>Open-Meteo Bounding Box Max Precip</title>
</head>
<body>
    <h3>Max Precipitation in Bounding Box (4 Corners)</h3>
    <label>Min Lat: <input id="minLat" value="42.8" step="0.01"></label><br>
    <label>Max Lat: <input id="maxLat" value="43.0" step="0.01"></label><br>
    <label>Min Lon: <input id="minLon" value="2.3" step="0.01"></label><br>
    <label>Max Lon: <input id="maxLon" value="2.5" step="0.01"></label><br>
    <button onclick="fetchPrecip()">Get Max Precip</button>
    <div id="results"></div>

    <script>
function fetchPrecip() {
    const minLat = parseFloat(document.getElementById('minLat').value);
    const maxLat = parseFloat(document.getElementById('maxLat').value);
    const minLon = parseFloat(document.getElementById('minLon').value);
    const maxLon = parseFloat(document.getElementById('maxLon').value);

    const corners = [
        {lat: minLat, lon: minLon},  // SW
        {lat: minLat, lon: maxLon},  // SE  
        {lat: maxLat, lon: minLon},  // NW
        {lat: maxLat, lon: maxLon}   // NE
    ];

    const latList = corners.map(c => c.lat).join(',');
    const lonList = corners.map(c => c.lon).join(',');

    const url = `https://api.open-meteo.com/v1/forecast?latitude=${latList}&longitude=${lonList}&hourly=precipitation&timezone=Europe/Paris&start_date=2025-12-28&end_date=2025-12-28`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            // data is array of 4 location objects
            const times = data[0].hourly.time;  // All locations share same times
            const precipArrays = data.map(location => location.hourly.precipitation);
            
            // Find max precip across 4 corners for each timeslot
            const maxPrecip = times.map((time, i) => {
                const cornerPrecip = precipArrays.map(arr => arr[i]);
                return Math.max(...cornerPrecip);
            });

            displayResults(times, maxPrecip);
        })
        .catch(err => {
            console.error('Error:', err);
            document.getElementById('results').innerHTML = 'Error fetching data';
        });
}

function displayResults(times, maxPrecip) {
    let html = '<table border="1"><tr><th>Time (CET)</th><th>Max Precip (mm)</th></tr>';
    for (let i = 0; i < times.length; i++) {
        html += `<tr><td>${times[i]}</td><td>${maxPrecip[i].toFixed(2)}</td></tr>`;
    }
    html += '</table>';
    document.getElementById('results').innerHTML = html;
}
    </script>
</body>
</html>
